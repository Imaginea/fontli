<% user = @photo.user %>
<% likes_cnt, comments_cnt = @photo.likes_count, @photo.comments_count %>
<% fnts_map = fonts_map_for_comments @recent_comments %>
<% if @perma %>
  <% content_for :head do %>
    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript" src="http://s.sharethis.com/loader.js"></script>
  <% end %>
  <% content_for :custom_js do %>
    <script type='text/javascript'>stLight.options({publisher: "09dd1850-3dce-44cd-9751-1f9b467cfaa2", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>
    <script>
      var options={ "publisher": "09dd1850-3dce-44cd-9751-1f9b467cfaa2", "position": "right", "ad": { "visible": false, "openDelay": 5, "closeDelay": 0}, "chicklets": { "items": ["facebook", "twitter"]}};
      var st_hover_widget = new sharethis.widgets.hoverbuttons(options);
    </script>
  <% end %>
<% end %>

<div class="popup <%= @open_popup ? 'open' : 'closed' %>">
  <div class="left-pop">
    <div class="bigpic">
      <img src="<%= @photo.url(:large) %>" style="width:480px;height:480px;"/>
      <a href="javascript:;" data-href='<%= show_feed_path %>' class="set4"></a>
      <a href="javascript:;" data-href='<%= show_feed_path %>' class="set5"></a>
    </div>

    <ul class="set1">
      <% ([] || ['a', 'b', 'c', 'd']).each do |char| %>
      <li class="set1-<%= char %>">
        <i></i>
        <div class="hover"></div>
      </li>
      <% end %>
      <li class='set1-cross'>
        <a href='javascript:;' class='cross'></a>
      </li>
    </ul>

    <ul class="set3">
      <li class="profile-name">
        <span><%= user.display_name %></span>
      </li>
      <li class="profile-dialog">
        <span><%= truncate(@photo.caption, :length => 100) %></span>
      </li>
      <li class="profile-detail">
        <%= photo_details_li %>
      </li>
    </ul>
    <% if @photo.fonts_count > 0 %>
    <% fnt = @photo.fonts.desc(:agrees_count).first %>
    <div class="set3b">
      <img src='<%= fnt.img_url %>' width="350px" /><br/>
      <span class='pop-disclaimer'><%= fnt.display_name %></span>
      <span><%= pluralize(fnt.agrees_count, 'Agree') %></span>
    </div>
    <% end %>
  </div>

  <div class="right-pop spotted" style="display:none;"></div>
  <div class="right-pop typetalk">
    <header>
      Typetalk
      <a href="javascript:;" class="collapse flt-left"></a>
      <a href="javascript:;" class="cross flt-right"></a>
      <!--  <a href="javascript:;" class="settings flt-right"></a> -->
    </header>
    <div class="content-a">
      <a class="propic" href="<%= profile_path(:user_id => user.id) %>">
        <img src="<%= user.url(:thumb) %>">
      </a>
      <ul>
        <li class="a">
          <a href="<%= profile_path(:user_id => user.id) %>"><span class="name"><%= user.username %></span></a>
          <span class="time"><%= timestamp(@photo.created_at) %></span>
        </li>
        <li class="b">
          <span><%= @photo.caption %></span>
        </li>
        <li class="c">
          <a href="#"></a>
        </li>
      </ul>
    </div>
    <div class="aa-typetalk content content-b">
      <div class="like-box">
        <% @recent_likes.each do |l| %>
          <% u = @users_map[l.user_id].first %>
          <a href="<%= profile_path(:user_id => u.id) %>" class="profile-img" style="background:url(<%= u.url_thumb %>)"></a>
        <% end %>
        <a href="javascript:;" class="likes">
          <!-- <img src="/web-assets/images/heartsmall.png" /> -->
          <% if likes_cnt > 0 && likes_cnt < 6 %>
            <br/><%= pluralize(likes_cnt, 'like') %>
          <% end %>
          <% if likes_cnt - @recent_likes.length > 0 %>
            <br/>+<%= pluralize(likes_cnt - @recent_likes.length, 'like') %>
          <% end %>
        </a>
      </div>
      <div class="comment-box clr">
        <% if comments_cnt > 0 %>
          <a href="javascript:;" class="comments"><%= pluralize(comments_cnt, 'comment') %></a></br>
        <% end %>
        <% @recent_comments.each do |c| %>
          <% u = @users_map[c.user_id].first %>
          <div class="comment">
            <a class="propic" href="<%= profile_path(:user_id => u.id) %>">
              <img src="<%= u.url_thumb %>">
            </a>
            <ul>
              <li class="a">
                <span class="name"><%= u.username %></span>
                <span class="time"><%= timestamp(c.created_at) %></span>
              </li>
              <li class="b">
                <span><%= c.body %></span>
                <% c.font_tag_ids.each do |ft_id| %>
                  <% f = fnts_map[ft_id.to_s] %>
                  <span>Spotted <%= f.display_name %></span>
                <% end %>
              </li>
            </ul>
          </div> <!-- comment -->
        <% end %>
      </div> <!-- comment_box -->
    </div>
    <!-- <div class="content-c">
      <a href="javascript:;">Your comment...</a>
    </div> -->
    <% if @photo.fonts_count > 0 %>
    <div class="bottom-nav">
      <span>
        <a href="javascript:;" class='view-spotted' data-url='<%= feed_fonts_path(:id => @photo.id) %>'>
          View Spottings
          <img src="/web-assets/images/arrow-right-nav.png" width="19" height="17" alt="arrow" title="arrow" /></a>
      </span>
    </div>
    <% end %>
  </div>
</div>
